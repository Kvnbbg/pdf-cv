//
//  EMiniApi+net.m
//  reactnativeelement
//
//  Created by 王铁山 on 2018/5/19.
//  Copyright © 2018年 王铁山. All rights reserved.
//

#import "EMiniSystemAPI.h"

#import "EMiniTool.h"

#import "EMiniNativeSystemAPI.h"

@interface EMiniSystemAPI()

@property(nonatomic, strong) EMiniNativeSystemAPI * api;

@end

@implementation EMiniSystemAPI

- (instancetype)init
{
    self = [super init];
    if (self) {
        self.api = [[EMiniNativeSystemAPI alloc] init];
    }
    return self;
}

RCT_EXPORT_MODULE();

RCT_EXPORT_METHOD(savePicureToAlbum: (NSString *)options callBack: (RCTResponseSenderBlock)callback) {
    NSDictionary * dic =  [EMiniTool stringToObject:options];
    if (!dic || ![dic isKindOfClass:[NSDictionary class]]) {
        callback(@[[EMiniTool errorStringWithDesck: @"参数错误"], [NSNull null]]);
    } else {
        [self.api savePicureToAlbum:dic result:^(BOOL success) {
            if (success) {
                callback(@[[NSNull null], [NSNull null]]);
            } else {
                callback(@[[EMiniTool errorStringWithDesck: @"保存失败"], [NSNull null]]);
            }
        }];
    }
}
    
RCT_EXPORT_METHOD(vibrate: (NSString *)type)
{
    [self.api vibrate:type];
}

RCT_EXPORT_METHOD(phoneCall: (NSString * )phoneNum) {
    [self.api phoneCall:phoneNum];
}

RCT_EXPORT_METHOD(getLocation: (RCTResponseSenderBlock)callback) {
    [self.api getLocation:^(id data, NSString *message) {
        callback(@[message ? [EMiniTool errorStringWithDesck:message] : [NSNull null],
                   data ? [EMiniTool objToString:data] : [NSNull null]]);
    }];
}

RCT_EXPORT_METHOD(getAllContacts: (RCTResponseSenderBlock)callback) {
    [self.api getAllContacts:^(id data, NSString *message) {
        callback(@[message ? [EMiniTool errorStringWithDesck:message] : [NSNull null],
                   data ? [EMiniTool objToString:data] : [NSNull null]]);
    }];
}

// MARK: - 通讯录选择
RCT_EXPORT_METHOD(contactPick: (RCTResponseSenderBlock)callback) {
    [self.api contactPick:^(id data, NSString *message) {
        callback(@[message ? [EMiniTool errorStringWithDesck:message] : [NSNull null],
                   data ? [EMiniTool objToString:data] : [NSNull null]]);
    }];
}

@end
