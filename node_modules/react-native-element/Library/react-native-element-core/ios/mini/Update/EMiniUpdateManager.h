//
//  EMiniUpdateManager.h
//  reactnativeelement
//
//  Created by 王铁山 on 2018/5/11.
//  Copyright © 2018年 王铁山. All rights reserved.
//

#import <Foundation/Foundation.h>

#import <UIKit/UIKit.h>

@class EMiniInfoModel, EMiniApi;

@protocol EMiniUpdateManagerDelegate;

/**
 什马小程序更新 manager
 */
@interface EMiniUpdateManager : NSObject

/**
 小程序ID
 */
@property(nonatomic, copy) NSString * miniId;

/**
 等待的最短时间 0.4
 */
@property(nonatomic, assign) double miniTime;

/**
 代理
 */
@property(nonatomic, weak) id <EMiniUpdateManagerDelegate> delegate;

/**
 api
 */
@property(nonatomic, strong, readonly)EMiniApi * miniApi;

/**
 是否正在更新中
 */
@property(nonatomic, assign, readonly) BOOL updating;

/**
 构造方法

 @param miniId 小程序ID
 @return 实例
 */
-(instancetype)init:(NSString *)miniId;

/**
 开始检查更新
 */
-(void)checkUpdate;

/**
 加载指定沙盒版本号

 @param version 版本号
 */
- (void)loadLocalVersion:(int)version;

/**
 同步查询是否正在更新。（线程安全）
 */
- (void)syncCheckUpdating: (void(^)(BOOL updating, EMiniUpdateManager * manager)) check;
@end



@protocol EMiniUpdateManagerDelegate <NSObject>

/// 展示未查询到小程序的提示
-(void) showNotFindMini;

/// 展示数据异常
-(void) showDataError:(NSString *)code;

/// 展示网络错误
-(void) showNetError;

/// 开始下载更新
-(void) beginDownLoad:(int)version;

/// 更新下载进度
-(void) updatePrgress:(double)progress;

/// 加载本地版本
-(void) loadLocalVersion:(NSString *)path;

/// loand mini info
-(void) loadMiniInfo:(EMiniInfoModel *)model;

/// 加载icon 图片
-(void) loadMiniIcon: (UIImage *)image;

@end
